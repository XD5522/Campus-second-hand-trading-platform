<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.campus_second_hand_trading_platform.dao.mapper.OrderMapper">
    <resultMap id="OrderVo" type="com.example.campus_second_hand_trading_platform.domain.vo.OrderVo">
        <id property="id" column="id"/>
        <result property="product_id" column="product_id"/>
        <result property="product_name" column="name"/>
        <result property="create_time" column="create_time"/>
        <result property="finish_time" column="finish_time"/>
        <result property="trading" column="trading"/>
        <result property="buyer" column="buyer"/>
        <result property="seller" column="seller"/>
        <result property="state" column="state"/>
    </resultMap>
    <select id="GetOrderListById" parameterType="Int" resultMap="OrderVo">
        select `order`.*,name from `order` join product p on `order`.product_id = p.id
        where `order`.buyer = #{id}
    </select>
    <select id="GetOrderListByPage" parameterType="Int" resultMap="OrderVo">
        select `order`.*,name from `order` join product p on `order`.product_id = p.id
        where `order`.buyer = #{id}
    </select>
    <select id="GetOrderListByPageAndState"  resultMap="OrderVo">
        select `order`.*,name from `order` join product p on `order`.product_id = p.id
        where `order`.buyer = #{id} and `order`.state=#{state}
    </select>
    <select id="GetOrderUnfinishedListByPage"  resultMap="OrderVo">
        select `order`.*,name from `order` join product p on `order`.product_id = p.id
        where `order`.buyer = #{id} and `order`.state!='已完成' and `order`.state!='已退货'
    </select>

    <update id="updateOrder">
        update `order` set state = #{state} where id = #{id}
    </update>
    <select id="GetPendingList" parameterType="Int" resultMap="OrderVo">
        select `order`.*,name from `order` join product p on `order`.product_id = p.id
        where `order`.buyer = #{id} and `order`.state = '待退货'
    </select>
</mapper>
